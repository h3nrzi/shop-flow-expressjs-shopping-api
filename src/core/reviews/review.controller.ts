import { ReviewService } from "./review.service";
import { Request, Response } from "express";

export class ReviewController {
	constructor(private readonly reviewService: ReviewService) {}

	async getAllReviews(req: Request, res: Response): Promise<void> {
		const { pagination, reviews } = await this.reviewService.getAllReviews(
			req.query,
			req.body.initialFilter
		);

		res.status(200).json({
			status: "success",
			results: reviews.length,
			pagination,
			data: { reviews },
		});
	}

	async getReviewById(req: Request, res: Response): Promise<void> {
		const { id } = req.params;
		const review = await this.reviewService.getReviewById(id);

		res.status(200).json({
			status: "success",
			data: { review },
		});
	}

	async createReview(req: Request, res: Response): Promise<void> {
		const review = await this.reviewService.createReview(req.body);

		res.status(201).json({
			status: "success",
			data: { review },
		});
	}

	async updateReview(req: Request, res: Response): Promise<void> {
		const { id } = req.params;
		const review = await this.reviewService.updateReview(id, req.body);

		res.status(200).json({
			status: "success",
			data: { review },
		});
	}

	async deleteReview(req: Request, res: Response): Promise<void> {
		const { id } = req.params;
		const { productId } = req.body;
		const userId = req.user._id;

		await this.reviewService.deleteReview(id, productId, userId);

		res.status(204).send();
	}
}
